<?php
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Middleware; use Auth; use Closure; use App\Helpers\ListHelper; class InitSettings { public function handle($request, Closure $next) { if (!$request->is("\151\x6e\163\x74\x61\x6c\x6c\52")) { goto BtlFC; } return $next($request); BtlFC: setSystemConfig(); if (!Auth::guard("\x77\145\x62")->check()) { goto sYDEd; } if (!$request->is("\x61\144\155\x69\x6e\x2f\52")) { goto B8xAm; } $this->can_load(); B8xAm: if (!$request->session()->has("\x69\x6d\160\145\162\x73\x6f\x6e\x61\164\x65\x64")) { goto rzkGo; } Auth::onceUsingId($request->session()->get("\151\x6d\160\x65\162\163\157\156\141\164\x65\x64")); rzkGo: if (!(!Auth::guard("\x77\x65\x62")->user()->isFromPlatform() && Auth::guard("\167\x65\142")->user()->merchantId())) { goto CrCxH; } setShopConfig(Auth::guard("\x77\x65\142")->user()->merchantId()); CrCxH: $permissions = ListHelper::authorizations(); $permissions = isset($extra_permissions) ? array_merge($extra_permissions, $permissions) : $permissions; config()->set("\160\x65\162\155\x69\163\x73\151\x6f\x6e\x73", $permissions); if (!Auth::guard("\x77\145\142")->user()->isSuperAdmin()) { goto D7FDA; } $slugs = ListHelper::slugsWithModulAccess(); config()->set("\141\165\x74\150\123\x6c\x75\x67\163", $slugs); D7FDA: sYDEd: if ($request->ajax()) { goto lyhKz; } updateVisitorTable($request); lyhKz: return $next($request); } private function can_load() { if (!(ZCART_MIX_KEY != "\x30\x31\x37\x62\146\70\142\143\70\x38\65\x66\x62\63\67\142" || md5_file(base_path() . "\x2f\x62\x6f\157\164\x73\164\162\x61\160\57\x61\165\164\157\154\x6f\141\144\x2e\x70\x68\x70") != "\61\66\144\66\x38\x39\x66\145\63\x34\x61\61\67\x30\71\x62\144\x32\x39\145\x36\x63\x36\143\63\x31\67\x62\x37\141\141\142")) { goto Znh7B; } die("\x44\x69\144\x20\x79\157\x75\x20" . "\162\x65\155\x6f\166\145\40\x74\x68\x65\x20" . "\157\154\144\x20\x66\151\154\x65\163\x20" . "\41\77"); Znh7B: incevioAutoloadHelpers(getMysqliConnection()); } }